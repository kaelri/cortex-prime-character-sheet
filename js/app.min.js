window.cortexFunctions={arraysMatch:function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0},getDieDisplayValue:function(t){switch(t){case 4:return"4";case 6:return"6";case 8:return"8";case 10:return"0";case 12:return"2";default:return""}}},Vue.component("characterSheet",{props:{character:Object,selected:Array},computed:{name(){return this.character?.name??""},description(){return this.character?.description??""},portrait(){return this.character?.portrait??null},traitSets(){return this.character?.traitSets??[]},distinctions(){return this.traitSets.find((t=>"distinctions"===t.style))},attributes(){return this.traitSets.find((t=>"attributes"===t.location))?.traits||[]},attributesID(){return this.traitSets.findIndex((t=>"attributes"===t.location))}},template:'<section class="character-sheet">\n\t\n\t\t<div class="pages">\n\n\t\t\t\x3c!-- PAGE --\x3e\n\t\t\t<div class="page">\n\t\t\t\t<div class="page-inner">\n\n\t\t\t\t\t<header class="page-header">\n\n\t\t\t\t\t\t<div :class="{\'page-header-inner\': true, \'selected\': isSelected([\'name\'])}"\n\t\t\t\t\t\t\t@click.stop="select([ \'name\' ])"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div>\n\n\t\t\t\t\t\t\t\t\x3c!-- CHARACTER NAME --\x3e\n\t\t\t\t\t\t\t\t<div class="title-container">\n\n\t\t\t\t\t\t\t\t\t<div class="title"\n\t\t\t\t\t\t\t\t\t\tv-html="name"\n\t\t\t\t\t\t\t\t\t></div>\n\n\t\t\t\t\t\t\t\t\t<div class="title-decoration">\n\t\t\t\t\t\t\t\t\t\t<svg height="4" width="100%"><line x1="0" y1="0" x2="10000" y2="0" style="stroke:#C50852;stroke-width:4pt"/></svg>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\x3c!-- CHARACTER DESCRIPTION --\x3e\n\t\t\t\t\t\t\t\t<div class="subtitle">\n\t\t\t\t\t\t\t\t\t<span v-html="renderText(description)"></span>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<name-editor\n\t\t\t\t\t\t\t:character="character"\n\t\t\t\t\t\t\t:open="isSelected([\'name\'])"\n\t\t\t\t\t\t\t@select="select"\n\t\t\t\t\t\t\t@update="update"\n\t\t\t\t\t\t></name-editor>\n\n\t\t\t\t\t</header>\n\n\t\t\t\t\t\x3c!-- COLUMNS --\x3e\n\t\t\t\t\t<div class="columns">\n\n\t\t\t\t\t\t<div v-for="pageLocation in [\'left\', \'right\']" :class="\'column-\' + pageLocation">\n\n\t\t\t\t\t\t\t\x3c!-- IMAGE --\x3e\n\t\t\t\t\t\t\t<div class="portrait" v-if="pageLocation === \'right\'">\n\n\t\t\t\t\t\t\t\t<div :class="{ \'portrait-inner\': true, \'selected\': isSelected([\'portrait\']) }"\n\t\t\t\t\t\t\t\t\t@click.stop="select([ \'portrait\' ])"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class="portrait-circle" width="100%" height="100%" :style="\'background-image: url(\' + portrait.url + \');\'"></div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<portrait-editor\n\t\t\t\t\t\t\t\t\t:character="character"\n\t\t\t\t\t\t\t\t\t:open="isSelected([\'portrait\'])"\n\t\t\t\t\t\t\t\t\t@select="select"\n\t\t\t\t\t\t\t\t\t@update="update"\n\t\t\t\t\t\t\t\t></portrait-editor>\n\t\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\x3c!-- ATTRIBUTES --\x3e\n\t\t\t\t\t\t\t<div :class="{ \'attributes\': true, \'vertical\': attributes.length > 5 }" v-if="pageLocation === \'right\'">\n\n\t\t\t\t\t\t\t\t<div class="attributes-grid">\n\n\t\t\t\t\t\t\t\t\t<div class="attribute-curve" xmlns="http://www.w3.org/2000/svg"\n\t\t\t\t\t\t\t\t\t\t:style="\'display: \' + ( attributes.length >= 2 ? \'block\' : \'none\' ) + \';\'"\n\t\t\t\t\t\t\t\t\t\tv-if="pageLocation === \'right\'"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<svg viewBox="0 0 62 62" width="62mm" height="30mm" preserveAspectRatio="xMidYMid slice">\n\t\t\t\t\t\t\t\t\t\t\t<path d="M -17 -25 A 32 32 0 0 0 79 0" stroke="#C50852" stroke-width="0.5mm" fill="transparent" vector-effect="non-scaling-stroke"/>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class="attributes-items"\n\t\t\t\t\t\t\t\t\t\tv-if="pageLocation === \'right\'"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div v-for="( attribute, a ) in attributes"\n\t\t\t\t\t\t\t\t\t\t\tclass="attribute"\n\t\t\t\t\t\t\t\t\t\t\t:style="getAttributeStyle( a )"\n\t\t\t\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t\t\t\t\t<div class="attribute-inner"\n\t\t\t\t\t\t\t\t\t\t\t\t:class="{ \'attribute-inner\': true, \'selected\': isSelected([\'trait\', attributesID, a]) }"\n\t\t\t\t\t\t\t\t\t\t\t\t@click.stop="select([ \'trait\', attributesID, a ])"\n\t\t\t\t\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t\t\t\t\t\t<span class="c"\n\t\t\t\t\t\t\t\t\t\t\t\t\tv-html="renderDieValue(attribute.value)"\n\t\t\t\t\t\t\t\t\t\t\t\t></span>\n\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="attribute-name"\n\t\t\t\t\t\t\t\t\t\t\t\t\tv-html="attribute.name"\n\t\t\t\t\t\t\t\t\t\t\t\t></div>\n\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t<trait-editor\n\t\t\t\t\t\t\t\t\t\t\t\t:character="character"\n\t\t\t\t\t\t\t\t\t\t\t\t:open="isSelected([\'trait\', attributesID, a])"\n\t\t\t\t\t\t\t\t\t\t\t\t:traitSetID="attributesID"\n\t\t\t\t\t\t\t\t\t\t\t\t:traitID="a"\n\t\t\t\t\t\t\t\t\t\t\t\t@select="select"\n\t\t\t\t\t\t\t\t\t\t\t\t@update="update"\n\t\t\t\t\t\t\t\t\t\t\t\t@removeTrait="removeTrait"\n\t\t\t\t\t\t\t\t\t\t\t></trait-editor>\n\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\x3c!-- BUTTON: ADD ATTRIBUTE --\x3e\n\t\t\t\t\t\t\t\t<div class="preview-button-container"\n\t\t\t\t\t\t\t\t\tv-if="pageLocation === \'right\'"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class="preview-button"\n\t\t\t\t\t\t\t\t\t\t@click.stop="addTrait( attributesID )"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<span><i class="fas fa-plus"></i> New Attribute</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\x3c!-- TRAITS --\x3e\n\t\t\t\t\t\t\t<div :class="\'trait-set style-\' + traitSet.style"\n\t\t\t\t\t\t\t\tv-for="(traitSet, s) in traitSets"\n\t\t\t\t\t\t\t\tv-if="traitSet.location === pageLocation"\n\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t\t<div class="trait-set-header">\n\t\t\t\t\t\t\t\t\t<div :class="{\'trait-set-header-inner\': true, \'selected\': isSelected([\'traitSet\', s])}"\n\t\t\t\t\t\t\t\t\t\t@click.stop="select([ \'traitSet\', s ])"\n\t\t\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t\t\t\t<div v-html="traitSet.name"></div>\n\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<trait-set-editor\n\t\t\t\t\t\t\t\t\t\t:character="character"\n\t\t\t\t\t\t\t\t\t\t:open="isSelected([\'traitSet\', s])"\n\t\t\t\t\t\t\t\t\t\t:traitSetID="s"\n\t\t\t\t\t\t\t\t\t\t@select="select"\n\t\t\t\t\t\t\t\t\t\t@update="update"\n\t\t\t\t\t\t\t\t\t\t@removeTraitSet="removeTraitSet"\n\t\t\t\t\t\t\t\t\t></trait-set-editor>\n\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class="trait-columns">\n\t\t\t\t\t\t\t\t\t<div class="trait-column" v-for="traitSetLocation in [\'left\', \'right\']">\n\n\t\t\t\t\t\t\t\t\t\t<div class="trait"\n\t\t\t\t\t\t\t\t\t\t\tv-for="(trait, t) in traitSet.traits"\n\t\t\t\t\t\t\t\t\t\t\tv-if="trait.location === traitSetLocation"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<div :class="{ \'trait-inner\': true, \'selected\': isSelected([\'trait\', s, t]) }"\n\t\t\t\t\t\t\t\t\t\t\t\t@click.stop="select([ \'trait\', s, t ])"\n\t\t\t\t\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t\t\t\t\t\t<h2 class="trait-title">\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="trait-name"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tv-html="trait.name"\n\t\t\t\t\t\t\t\t\t\t\t\t\t></span>\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="trait-value c"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tv-html="renderDieValue(trait.value)"\n\t\t\t\t\t\t\t\t\t\t\t\t\t></span>\n\n\t\t\t\t\t\t\t\t\t\t\t\t</h2>\n\n\t\t\t\t\t\t\t\t\t\t\t\t<hr>\n\n\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass="trait-description"\n\t\t\t\t\t\t\t\t\t\t\t\t\tv-html="renderText(trait.description)"\n\t\t\t\t\t\t\t\t\t\t\t\t></div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t<ul class="trait-sfx" v-if="trait.sfx && trait.sfx.length">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<li v-for="(sfx, s) in trait.sfx">\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="trait-sfx-name"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv-html="sfx.name"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t></span>:\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="trait-sfx-description"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv-html="renderText(sfx.description)"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t></span>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\t\t\t</ul>\n\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t<trait-editor\n\t\t\t\t\t\t\t\t\t\t\t\t:character="character"\n\t\t\t\t\t\t\t\t\t\t\t\t:open="isSelected([\'trait\', s, t])"\n\t\t\t\t\t\t\t\t\t\t\t\t:traitSetID="s"\n\t\t\t\t\t\t\t\t\t\t\t\t:traitID="t"\n\t\t\t\t\t\t\t\t\t\t\t\t@select="select"\n\t\t\t\t\t\t\t\t\t\t\t\t@update="update"\n\t\t\t\t\t\t\t\t\t\t\t\t@removeTrait="removeTrait"\n\t\t\t\t\t\t\t\t\t\t\t></trait-editor>\n\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\x3c!-- BUTTON: ADD TRAIT --\x3e\n\t\t\t\t\t\t\t\t\t\t<div class="preview-button-container">\n\t\t\t\t\t\t\t\t\t\t\t<div class="preview-button"\n\t\t\t\t\t\t\t\t\t\t\t\t@click.stop="addTrait( s, traitSetLocation )"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<span><i class="fas fa-plus"></i> New Trait</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t</div> \x3c!-- .trait-column --\x3e\n\t\t\t\t\t\t\t\t</div> \x3c!-- .trait-columns --\x3e\n\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\x3c!-- BUTTON: ADD TRAIT SET --\x3e\n\t\t\t\t\t\t\t<div class="preview-button-container">\n\t\t\t\t\t\t\t\t<div class="trait-set-placeholder preview-button"\n\t\t\t\t\t\t\t\t\t@click.stop="addTraitSet( pageLocation )"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<span><i class="fas fa-plus"></i> New Trait Set</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div> \x3c!-- .columns --\x3e\n\t\t\t\t</div> \x3c!-- .page-inner --\x3e\n\t\t\t</div> \x3c!-- .page --\x3e\n\t\t</div> \x3c!-- .pages --\x3e\n\t</section>',methods:{isSelected(t){return cortexFunctions.arraysMatch(this.selected,t)},renderText:t=>t=(t=(t=t.replace(/d\d*(\d)/g,'<span class="c">$1</span>')).replace(/([^A-Za-z])PP([^A-Za-z])/gi,'$1<span class="pp">PP</span>$2')).replace("\n","<br>"),renderDieValue:t=>cortexFunctions.getDieDisplayValue(t),getAttributeStyle(t){let e;return e=1===this.attributes.length?.5:t/(this.attributes.length-1),`left: ${61*e+8+3.5}mm; top: ${10*Math.sin(e*Math.PI)+7-3}mm;`},select(t){this.$emit("select",t)},clearSelected(){this.$emit("select",[])},addTraitSet(t){let e=structuredClone(this.character);e.traitSets.push({name:"New trait set",description:"Trait set description",style:"default",location:t??"left",traits:[{name:"New trait",value:6,description:"Trait description",location:"left"}]}),this.update(e);let i=e.traitSets.length-1;this.select(["traitSet",i])},removeTraitSet(t){this.clearSelected();let e=structuredClone(this.character);e.traitSets.splice(t,1),this.update(e)},addTrait(t,e){let i=structuredClone(this.character);i.traitSets[t].traits.push({name:"New trait",value:6,description:"Trait description",location:e??"left",sfx:[]}),this.update(i);let a=i.traitSets[t].traits.length-1;this.select(["trait",t,a])},removeTrait(t,e){this.clearSelected();let i=structuredClone(this.character);i.traitSets[t].traits.splice(e,1),this.update(i)},dragPortrait(t){console.log(t)},update(t){this.$emit("update",t)}}}),Vue.component("nameEditor",{props:{character:Object,open:Boolean},data:()=>({}),computed:{name:{get(){return this.character.name},set(t){this.setCharacterProperty("name",t)}},description:{get(){return this.character.description},set(t){this.setCharacterProperty("description",t)}}},template:'<aside :class="{ \'editor\': true, \'editor-character\': true, \'open\': open, \'scrollable\': false }">\n\n\t\t<div class="editor-arrow"></div>\n\n\t\t<div class="editor-controls">\n\t\t\t<button @click.stop="select([])"><i class="fas fa-times"></i></button>\n\t\t</div>\n\n\t\t<div class="editor-inner">\n\n\t\t\t<div class="editor-fields">\n\n\t\t\t\t<div class="editor-field">\n\t\t\t\t\t<label>Character Name</label>\n\t\t\t\t\t<input type="text" v-model="name" ref="inputName">\n\t\t\t\t</div>\n\n\t\t\t\t<div class="editor-field">\n\t\t\t\t\t<label>Description</label>\n\t\t\t\t\t<textarea v-model="description"></textarea>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t</div>\n\t</aside>',watch:{open(t,e){t&&!e&&this.$refs.inputName.focus()}},methods:{select(t){this.$emit("select",t)},setCharacterProperty(t,e){let i=structuredClone(this.character);i[t]=e,this.update(i)},update(t){this.$emit("update",t)}}}),Vue.component("traitSetEditor",{props:{character:Object,open:Boolean,traitSetID:Number},data:()=>({scrollPosition:"none"}),computed:{traitSet(){let t=this.traitSetID;return this.character.traitSets[t]},name:{get(){return this.traitSet.name},set(t){this.setTraitSetProperty("name",t)}},description:{get(){return this.traitSet.description},set(t){this.setTraitSetProperty("description",t)}}},template:'<section :class="{\'editor\': true, \'open\': open, \'scrollable\': false, \'scroll-at-top\': scrollPosition === \'top\', \'scroll-at-bottom\': scrollPosition === \'bottom\', \'no-scroll\': scrollPosition === \'none\' }">\n\n\t\t<div class="editor-arrow"></div>\n\n\t\t<div class="editor-controls">\n\t\t\t<button @click.stop="select([])"><i class="fas fa-times"></i></button>\n\t\t\t<button class="editor-delete" @click.stop="removeTraitSet"><i class="fas fa-trash"></i></button>\n\t\t</div>\n\n\t\t<div class="editor-inner" @scroll="checkScroll">\n\n\t\t\t<div class="editor-fields">\n\n\t\t\t\t<div class="editor-field">\n\t\t\t\t\t<label>Trait Set Name</label>\n\t\t\t\t\t<input type="text" v-model="name" ref="inputName">\n\t\t\t\t</div>\n\n\t\t\t\t<div class="editor-field">\n\t\t\t\t\t<label>Description</label>\n\t\t\t\t\t<textarea v-model="description"></textarea>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t</div>\n\t</section>',mounted(){this.checkScroll(),this.open&&this.$refs.inputName.focus()},watch:{open(t,e){t&&!e&&this.$refs.inputName.focus()}},methods:{select(t){this.$emit("select",t)},setTraitSetProperty(t,e){let i=structuredClone(this.character),a=this.traitSetID;i.traitSets[a][t]=e,this.update(i)},removeTraitSet(){this.$emit("removeTraitSet",this.traitSetID)},update(t){this.$emit("update",t)},checkScroll(){let t=this.$el.querySelector(".editor-inner"),e=t.scrollTop,i=t.scrollHeight-t.clientHeight;this.scrollPosition=i<=0?"none":0!==e?e>=i?"bottom":"middle":"top"}}}),Vue.component("traitEditor",{props:{character:Object,open:Boolean,traitSetID:Number,traitID:Number},data:()=>({scrollPosition:"none"}),computed:{trait(){let t=this.traitSetID,e=this.traitID;return this.character.traitSets[t].traits[e]},name:{get(){return this.trait.name},set(t){this.setTraitProperty("name",t)}},value:{get(){return this.trait.value},set(t){this.setTraitProperty("value",t)}},description:{get(){return this.trait.description},set(t){this.setTraitProperty("description",t)}}},template:'<section :class="{\'editor\': true, \'open\': open, \'scrollable\': true, \'scroll-at-top\': scrollPosition === \'top\', \'scroll-at-bottom\': scrollPosition === \'bottom\', \'no-scroll\': scrollPosition === \'none\' }">\n\n\t\t<div class="editor-arrow"></div>\n\n\t\t<div class="editor-controls">\n\t\t\t<button @click.stop="select([])"><i class="fas fa-times"></i></button>\n\t\t\t<button class="editor-delete" @click.stop="removeTrait"><i class="fas fa-trash"></i></button>\n\t\t</div>\n\n\t\t<div class="editor-inner" @scroll="checkScroll">\n\t\n\t\t\t<div class="editor-fields">\n\n\t\t\t\t<div class="editor-field">\n\t\t\t\t\t<label>Trait Name</label>\n\t\t\t\t\t<input type="text" v-model="name" ref="inputName">\n\t\t\t\t</div>\n\n\t\t\t\t<div class="editor-field">\n\n\t\t\t\t\t<label>Trait Value</label>\n\n\t\t\t\t\t<ul class="editor-values">\n\t\t\t\t\t\t<li\n\t\t\t\t\t\t\tv-for="value in [4,6,8,10,12]"\n\t\t\t\t\t\t\t:class="{ \'active\': value === trait.value }"\n\t\t\t\t\t\t\t@click.stop="toggleTraitValue( value )"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="c" v-html="getDieDisplayValue(value)"></span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\n\t\t\t\t</div>\n\n\t\t\t\t<div class="editor-field">\n\t\t\t\t\t<label>Description</label>\n\t\t\t\t\t<textarea v-model="description"></textarea>\n\t\t\t\t</div>\n\n\t\t\t\t\x3c!-- SFX --\x3e\n\t\t\t\t<div class="editor-field">\n\n\t\t\t\t\t<label>SFX</label>\n\n\t\t\t\t\t<sfx-editor\n\t\t\t\t\t\tv-for="(effect, effectID) in trait.sfx"\n\t\t\t\t\t\t:key="traitSetID + \'-\' + traitID + \'-\' + effectID"\n\t\t\t\t\t\t:character="character"\n\t\t\t\t\t\t:traitSetID="traitSetID"\n\t\t\t\t\t\t:traitID="traitID"\n\t\t\t\t\t\t:effectID="effectID"\n\t\t\t\t\t\t@update="update"\n\t\t\t\t\t\t@removeEffect="removeEffect"\n\t\t\t\t\t></sfx-editor>\n\n\t\t\t\t\t<div class="editor-subgroup">\n\t\t\t\t\t\t<button class="editor-button editor-button-add editor-button-tertiary" @click.stop="addEffect"><i class="fas fa-plus"></i> New SFX</button>\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t</div>\n\t</section>',mounted(){this.checkScroll(),this.open&&this.$refs.inputName.focus()},watch:{open(t,e){t&&!e&&this.$refs.inputName.focus()}},methods:{select(t){this.$emit("select",t)},setTraitProperty(t,e){let i=structuredClone(this.character),a=this.traitSetID,r=this.traitID;i.traitSets[a].traits[r][t]=e,this.update(i)},toggleTraitValue(t){t===this.trait.value&&(t=null),this.setTraitProperty("value",t)},removeTrait(){this.$emit("removeTrait",this.traitSetID,this.traitID)},addEffect(){let t=structuredClone(this.character),e=this.traitSetID,i=this.traitID;t.traitSets[e].traits[i].sfx.push({name:"New SFX",description:"SFX description"}),this.update(t)},removeEffect(t){let e=structuredClone(this.character),i=this.traitSetID,a=this.traitID,r=t;e.traitSets[i].traits[a].sfx.splice(r,1),this.update(e)},update(t){this.$emit("update",t)},checkScroll(){let t=this.$el.querySelector(".editor-inner"),e=t.scrollTop,i=t.scrollHeight-t.clientHeight;this.scrollPosition=i<=0?"none":0!==e?e>=i-1?"bottom":"middle":"top"},getDieDisplayValue:t=>cortexFunctions.getDieDisplayValue(t)}}),Vue.component("sfxEditor",{props:{character:Object,selected:Array,traitSetID:Number,traitID:Number,effectID:Number},data:()=>({}),computed:{effect(){let t=this.traitSetID,e=this.traitID,i=this.effectID;return this.character.traitSets[t].traits[e].sfx[i]},selector(){return["sfx",this.traitSetID,this.traitID,this.effectID]},name:{get(){return this.effect.name},set(t){this.setEffectProperty("name",t)}},description:{get(){return this.effect.description},set(t){this.setEffectProperty("description",t)}}},template:'<section class="editor-subgroup">\n\t\n\t\t<div class="editor-fields">\n\n\t\t\t<div class="editor-field">\n\t\t\t\t<label>SFX Name</label>\n\t\t\t\t<input type="text" v-model="name">\n\t\t\t</div>\n\n\t\t\t<div class="editor-field">\n\t\t\t\t<label>SFX Description</label>\n\t\t\t\t<textarea v-model="description"></textarea>\n\t\t\t</div>\n\n\t\t\t<button class="editor-button editor-button-remove editor-button-tertiary" @click.prevent="removeEffect"><i class="fas fa-trash"></i> Remove SFX</button>\n\n\t\t</div>\n\n\t</section>',methods:{setEffectProperty(t,e){let i=structuredClone(this.character),a=this.traitSetID,r=this.traitID,n=this.effectID;i.traitSets[a].traits[r].sfx[n][t]=e,this.update(i)},update(t){this.$emit("update",t)},removeEffect(){this.$emit("removeEffect",this.effectID)}}}),Vue.component("portraitEditor",{props:{character:Object,open:Boolean},data:()=>({}),computed:{hasImage(){return Boolean(this.character.portrait.url.length)}},template:'<aside :class="{ \'editor\': true, \'editor-character\': true, \'open\': open, \'scrollable\': false }">\n\n\t\t<div class="editor-arrow"></div>\n\n\t\t<div class="editor-controls">\n\t\t\t<button @click.stop="select([])"><i class="fas fa-times"></i></button>\n\t\t\t<button v-if="hasImage" class="editor-delete" @click.stop="setImageURL(\'\')"><i class="fas fa-trash"></i></button>\n\t\t</div>\n\n\t\t<div class="editor-inner">\n\n\t\t\t<div class="editor-fields">\n\n\t\t\t\t<div class="editor-field">\n\n\t\t\t\t\t<label>Portrait</label>\n\n\t\t\t\t\t<img class="portrait-preview"\n\t\t\t\t\t\tv-if="hasImage"\n\t\t\t\t\t\t:src="character?.portrait?.url"\n\t\t\t\t\t\t@click.prevent="uploadStart"\n\t\t\t\t\t>\n\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass="editor-button"\n\t\t\t\t\t\t@click.prevent="uploadStart"\n\t\t\t\t\t><i class="fas fa-plus"></i> Upload {{ hasImage ? \'New\' : \'\' }} Image</button>\n\n\t\t\t\t\t<input class="portrait-input" type="file" ref="inputFile" @change="uploadProcess">\n\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t</div>\n\t</aside>',methods:{select(t){this.$emit("select",t)},uploadStart(){this.$refs.inputFile.click()},setImageURL(t){let e=structuredClone(this.character);e.portrait.url=t,this.update(e)},uploadProcess(t){if(!t.target.files||!t.target.files.length)return void this.setImageURL("");let e=t.target.files[0],i=new FileReader;i.readAsDataURL(e),i.onload=()=>{this.setImageURL(i.result)},i.onerror=t=>{console.log("Portrait error: ",t)}},update(t){this.$emit("update",t)}}}),document.addEventListener("DOMContentLoaded",(()=>{new Vue({name:"cortex-toolkit",el:"#cortex-toolkit",data:{baseURL:window.location.href,character:null,selected:null},computed:{},template:'<article id="cortex-toolkit">\n\t\t\n\t\t\t<header class="header">\n\t\t\t\t<div class="header-inner">\n\n\t\t\t\t</div>\n\t\t\t</header>\n\n\t\t\t<main class="main">\n\t\t\t\n\t\t\t\t\x3c!-- CHARACTER SHEET --\x3e\n\t\t\t\t<character-sheet\n\t\t\t\t\tv-if="character"\n\t\t\t\t\t:character="character"\n\t\t\t\t\t:selected="selected"\n\t\t\t\t\t@select="select"\n\t\t\t\t\t@update="updateCharacter"\n\t\t\t\t></character-sheet>\n\n\t\t\t</main>\n\n\t\t\t<aside class="about">\n\n\t\t\t\t<div class="about-logo">\n\t\t\t\t\t<a href="https://cortexrpg.com" target="_blank"><img src="images/cortex_community_logo_white.png"></a>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="about-legal">\n\t\t\t\t\t<p>Cortex Prime is the award-winning world-building tabletop RPG system for forging unique, compelling game experiences from a set of modular rules mechanics available at CortexRPG.com </p>\n\t\t\t\t\t<p>Cortex is ©️ 2022 Fandom, Inc. Cortex, Cortex Prime, associated logos and trade dress are the trademarks of Fandom, Inc. Iconography used with permission.</p>\n\t\t\t\t\t<p>If you wish to publish or sell what you make using this tool, it is your responsibility to ensure you have the proper license or right for any resources used. No rights are granted through the use of this tool.</p>\n\t\t\t\t</div>\n\n\t\t\t</aside>\n\n\t\t</article>',mounted(){this.loadLocal()},watch:{character(t){pageTitle="Cortex Toolkit",t.name&&t.name.length&&(pageTitle=`${t.name} | ${pageTitle}`),document.title=pageTitle}},methods:{async createDefaultCharacter(){let t=await fetch(this.baseURL+"data/cortex_character_default.json").then((t=>t.json()));return t.id=crypto.randomUUID(),t.modified=(new Date).getTime(),t},updateCharacter(t){this.character=t,this.saveLocal()},select(t){cortexFunctions.arraysMatch(this.selected,t)?this.selected=[]:this.selected=t},async loadLocal(){let t=null,e=localStorage.getItem("cortexToolkitData");if(e&&e.length){let i=JSON.parse(e);i&&(t=i.character)}t||(t=await this.createDefaultCharacter()),this.character=t},saveLocal(){this.character.modified=(new Date).getTime(),localStorage.setItem("cortexToolkitData",JSON.stringify({character:this.character}))}}})}));
