document.addEventListener("DOMContentLoaded",(()=>{new Vue({name:"cortex-tools",el:"#cortex-tools",data:{character:null},computed:{},template:'<cortex-character-sheet\n\t\t\tv-if="character"\n\t\t\t:character="character"\n\t\t\t@edited="setCharacter"\n\t\t></cortex-character-sheet>',mounted(){this.loadLocal()},methods:{createDefaultCharacter:()=>({name:"NAME",description:"Description",distinctions:[{name:"Distinction 1",value:8,description:"Trait description",sfx:[{name:"Hinder",description:"Gain a PP when you switch out this distinction’s d8 for a d4."}]},{name:"Distinction 2",value:8,description:"Trait description",sfx:[{name:"Hinder",description:"Gain a PP when you switch out this distinction’s d8 for a d4."}]},{name:"Distinction 3",value:8,description:"Trait description",sfx:[{name:"Hinder",description:"Gain a PP when you switch out this distinction’s d8 for a d4."}]}],attributes:[{name:"Attribute 1",value:8,description:"Trait description."},{name:"Attribute 2",value:8,description:"Trait description."},{name:"Attribute 3",value:8,description:"Trait description."}],sets:[{name:"New Trait Group",style:"default",page:1,column:1,traits:[{name:"New trait",value:6,description:"Trait description",column:1},{name:"New trait",value:6,description:"Trait description",column:1},{name:"New trait",value:6,description:"Trait description",column:1}]},{name:"New Trait Group",style:"values",page:1,column:1,traits:[{name:"New trait",value:6,description:"Trait description",column:1},{name:"New trait",value:6,description:"Trait description",column:1},{name:"New trait",value:6,description:"Trait description",column:1},{name:"New trait",value:6,description:"Trait description",column:2},{name:"New trait",value:6,description:"Trait description",column:2}]},{name:"New Trait Group",style:"signature-asset",page:1,column:2,traits:[{name:"New trait",value:6,description:"Trait description",column:1},{name:"New trait",value:6,description:"Trait description",column:1},{name:"New trait",value:6,description:"Trait description",column:1}]}],image:{value:"",x:0,y:0,zoom:1}}),setCharacter(t){this.character=t,this.saveLocal()},loadLocal(){let t=null,n=localStorage.getItem("cortexCS");if(n&&n.length){let e=JSON.parse(n);e&&(t=e.character)}t||(t=this.createDefaultCharacter()),this.character=t},saveLocal(){localStorage.setItem("cortexCS",JSON.stringify({character:this.character}))}}})})),Vue.component("cortexCharacterSheet",{props:{character:Object},data:function(){return structuredClone(this.character)},template:'<article class="cortex-character-sheet">\n\t\n\t\t<div class="pages">\n\n\t\t\t\x3c!-- PAGE --\x3e\n\t\t\t<div id="page-1" class="page">\n\t\t\t\t<div class="content">\n\n\t\t\t\t\t\x3c!-- CHARACTER NAME --\x3e\n\t\t\t\t\t<div class="row" id="name">\n\n\t\t\t\t\t\t<div class="title character-name"\n\t\t\t\t\t\t\tv-html="name"\n\t\t\t\t\t\t\tcontenteditable\n\t\t\t\t\t\t\t@blur="editContent( $event, [\'name\'] )"\n\t\t\t\t\t\t></div>\n\n\t\t\t\t\t\t<div class="ruler">\n\t\t\t\t\t\t\t<svg height="4" width="100%"><line x1="0" y1="0" x2="10000" y2="0" style="stroke:#C50852;stroke-width:4pt"/></svg>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\n\t\t\t\t\t\x3c!-- LEFT COLUMN --\x3e\n\t\t\t\t\t<div class="left">\n\n\t\t\t\t\t\t\x3c!-- CHARACTER DESCRIPTION --\x3e\n\t\t\t\t\t\t<div id="description"\n\t\t\t\t\t\t\tv-html="description"\n\t\t\t\t\t\t\tcontenteditable\n\t\t\t\t\t\t\t@blur="editContent( $event, [\'description\'] )"\n\t\t\t\t\t\t></div>\n\n\t\t\t\t\t\t\x3c!-- DISTINCTIONS --\x3e\n\t\t\t\t\t\t<div id="distinctions" class="trait-group">\n\n\t\t\t\t\t\t\t<div class="trait-group-header">Distinctions</div>\n\n\t\t\t\t\t\t\t<div class="traits">\n\t\t\t\t\t\t\t\t<div class="trait" v-for="(distinction, d) in distinctions">\n\n\t\t\t\t\t\t\t\t\t<h2 class="inline"\n\t\t\t\t\t\t\t\t\t\tv-html="distinction.name"\n\t\t\t\t\t\t\t\t\t\tcontenteditable\n\t\t\t\t\t\t\t\t\t\t@blur="editContent( $event, [\'distinctions\', d, \'name\'] )"\n\t\t\t\t\t\t\t\t\t></h2>\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<h2>\n\t\t\t\t\t\t\t\t\t\t<span class="c"\n\t\t\t\t\t\t\t\t\t\t\tv-html="distinction.value"\n\t\t\t\t\t\t\t\t\t\t\tcontenteditable\n\t\t\t\t\t\t\t\t\t\t\t@blur="editContent( $event, [\'distinctions\', d, \'value\'] )"\n\t\t\t\t\t\t\t\t\t\t></span>\n\t\t\t\t\t\t\t\t\t</h2>\n\n\t\t\t\t\t\t\t\t\t<hr>\n\n\t\t\t\t\t\t\t\t\t<div v-html="distinction.description"\n\t\t\t\t\t\t\t\t\t\tcontenteditable\n\t\t\t\t\t\t\t\t\t></div>\n\n\t\t\t\t\t\t\t\t\t<ul class="distinction-sfx" v-if="distinction.sfx.length">\n\n\t\t\t\t\t\t\t\t\t\t<li v-for="(sfx, s) in distinction.sfx">\n\n\t\t\t\t\t\t\t\t\t\t\t<span class="sfx-name"\n\t\t\t\t\t\t\t\t\t\t\t\tv-html="sfx.name"\n\t\t\t\t\t\t\t\t\t\t\t\tcontenteditable\n\t\t\t\t\t\t\t\t\t\t\t\t@blur="editContent( $event, [\'distinctions\', d, \'sfx\', s, \'name\'] )"\n\t\t\t\t\t\t\t\t\t\t\t></span>:\n\n\t\t\t\t\t\t\t\t\t\t\t<span class="sfx-description"\n\t\t\t\t\t\t\t\t\t\t\t\tv-html="sfx.description"\n\t\t\t\t\t\t\t\t\t\t\t\tcontenteditable\n\t\t\t\t\t\t\t\t\t\t\t\t@blur="editContent( $event, [\'distinctions\', d, \'sfx\', s, \'description\'] )"\n\t\t\t\t\t\t\t\t\t\t\t></span>\n\n\t\t\t\t\t\t\t\t\t\t</li>\n\n\t\t\t\t\t\t\t\t\t</ul>\n\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\x3c!-- TRAITS --\x3e\n\t\t\t\t\t\t<div :class="\'trait-group \' + set.style"\n\t\t\t\t\t\t\tv-for="(set, s) in sets"\n\t\t\t\t\t\t\tv-if="set.page === 1 && set.column === 1"\n\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t<div id="context-menu-button" class="no-print"></div>\n\n\t\t\t\t\t\t\t<div class="trait-group-header"\n\t\t\t\t\t\t\t\tv-html="set.name"\n\t\t\t\t\t\t\t\tcontenteditable\n\t\t\t\t\t\t\t\t@blur="editContent( $event, [\'set\', s, \'name\'] )"\n\t\t\t\t\t\t\t></div>\n\n\t\t\t\t\t\t\t<div class="traits" v-for="column in 2">\n\n\t\t\t\t\t\t\t\t<div class="trait" v-for="(trait, t) in set.traits" v-if="trait.column === column">\n\n\t\t\t\t\t\t\t\t\t<div id="remove-item" class="no-print"></div>\n\n\t\t\t\t\t\t\t\t\t<h2 class="inline"\n\t\t\t\t\t\t\t\t\t\tv-html="trait.name"\n\t\t\t\t\t\t\t\t\t\tcontenteditable\n\t\t\t\t\t\t\t\t\t\t@blur="editContent( $event, [\'set\', s, \'trait\', t, \'name\'] )"\n\t\t\t\t\t\t\t\t\t></h2>\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<h2>\n\t\t\t\t\t\t\t\t\t\t<span class="c"\n\t\t\t\t\t\t\t\t\t\t\tv-html="trait.value"\n\t\t\t\t\t\t\t\t\t\t\tcontenteditable\n\t\t\t\t\t\t\t\t\t\t\t@blur="editContent( $event, [\'set\', s, \'trait\', t, \'name\'] )"\n\t\t\t\t\t\t\t\t\t\t></span>\n\t\t\t\t\t\t\t\t\t</h2>\n\n\t\t\t\t\t\t\t\t\t<hr>\n\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tv-html="trait.description"\n\t\t\t\t\t\t\t\t\t\tcontenteditable\n\t\t\t\t\t\t\t\t\t\t@blur="editContent( $event, [\'set\', s, \'trait\', t, \'description\'] )"\n\t\t\t\t\t\t\t\t\t></div>\n\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\x3c!-- BUTTON: ADD TRAIT --\x3e\n\t\t\t\t\t\t\t\t<div id="trait-placeholder" class="add-item no-print"></div>\n\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\x3c!-- BUTTON: ADD TRAIT GROUP --\x3e\n\t\t\t\t\t\t<div id="trait-group-placeholder" class="add-item no-print"></div>\n\n\t\t\t\t\t</div>\n\n\t\t\t\t\t\x3c!-- RIGHT COLUMN --\x3e\n\t\t\t\t\t<div class="right">\n\n\t\t\t\t\t\t\x3c!-- IMAGE --\x3e\n\t\t\t\t\t\t<div id="portrait">\n\t\t\t\t\t\t\t<div id="circle" width=100% height=100%>\n\t\t\t\t\t\t\t\t<div id="edit-image" class="no-print"></div>\n\t\t\t\t\t\t\t\t<img src="" width="110%" draggable="false" id="image"></img>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\x3c!-- ATTRIBUTES --\x3e\n\t\t\t\t\t\t<div id="attribute-curve" xmlns="http://www.w3.org/2000/svg" :style="\'display: \' + ( attributes.length >= 2 ? \'block\' : \'none\' ) + \';\'">\n\t\t\t\t\t\t\t<svg viewBox="0 0 62 62" width="62mm" height="30mm" preserveAspectRatio="xMidYMid slice">\n\t\t\t\t\t\t\t\t<path d="M -17 -25 A 32 32 0 0 0 79 0" stroke="#C50852" stroke-width="0.5mm" fill="transparent" vector-effect="non-scaling-stroke"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div id="attributes" :class="{ \'vertical\': attributes.length > 5 }">\n\t\t\t\t\t\t\t<div v-for="( attribute, a ) in attributes"\n\t\t\t\t\t\t\t\t:class="{ \'attribute\': true, \'vertical\': attributes.length > 5 }"\n\t\t\t\t\t\t\t\t:style="getAttributeStyle( a )"\n\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t\t<span class="c"\n\t\t\t\t\t\t\t\t\tv-html="attribute.value"\n\t\t\t\t\t\t\t\t\tcontenteditable\n\t\t\t\t\t\t\t\t\t@blur="editContent( $event, [\'attributes\', a, \'value\'] )"\n\t\t\t\t\t\t\t\t></span>\n\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-html="attribute.name"\n\t\t\t\t\t\t\t\t\tcontenteditable\n\t\t\t\t\t\t\t\t\t@blur="editContent( $event, [\'attributes\', a, \'name\'] )"\n\t\t\t\t\t\t\t\t></div>\n\n\t\t\t\t\t\t\t\t<div id="remove-item" class="no-print"></div>\n\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\x3c!-- BUTTON: ADD ATTRIBUTE --\x3e\n\t\t\t\t\t\t\t<div id="attribute-placeholder" class="add-item no-print"></div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\x3c!-- TRAITS --\x3e\n\t\t\t\t\t\t<div :class="\'trait-group \' + set.style"\n\t\t\t\t\t\t\tv-for="(set, s) in sets"\n\t\t\t\t\t\t\tv-if="set.page === 1 && set.column === 2"\n\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t<div id="context-menu-button" class="no-print"></div>\n\n\t\t\t\t\t\t\t<div class="trait-group-header"\n\t\t\t\t\t\t\t\tv-html="set.name"\n\t\t\t\t\t\t\t\tcontenteditable\n\t\t\t\t\t\t\t\t@blur="editContent( $event, [\'set\', s, \'name\'] )"\n\t\t\t\t\t\t\t></div>\n\n\t\t\t\t\t\t\t<div class="traits" v-for="column in 2">\n\n\t\t\t\t\t\t\t\t<div class="trait" v-for="(trait, t) in set.traits" v-if="trait.column === column">\n\n\t\t\t\t\t\t\t\t\t<div id="remove-item" class="no-print"></div>\n\n\t\t\t\t\t\t\t\t\t<h2 class="inline"\n\t\t\t\t\t\t\t\t\t\tv-html="trait.name"\n\t\t\t\t\t\t\t\t\t\tcontenteditable\n\t\t\t\t\t\t\t\t\t\t@blur="editContent( $event, [\'set\', s, \'trait\', t, \'name\'] )"\n\t\t\t\t\t\t\t\t\t></h2>\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<h2>\n\t\t\t\t\t\t\t\t\t\t<span class="c"\n\t\t\t\t\t\t\t\t\t\t\tv-html="trait.value"\n\t\t\t\t\t\t\t\t\t\t\tcontenteditable\n\t\t\t\t\t\t\t\t\t\t\t@blur="editContent( $event, [\'set\', s, \'trait\', t, \'name\'] )"\n\t\t\t\t\t\t\t\t\t\t></span>\n\t\t\t\t\t\t\t\t\t</h2>\n\n\t\t\t\t\t\t\t\t\t<hr>\n\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tv-html="trait.description"\n\t\t\t\t\t\t\t\t\t\tcontenteditable\n\t\t\t\t\t\t\t\t\t\t@blur="editContent( $event, [\'set\', s, \'trait\', t, \'description\'] )"\n\t\t\t\t\t\t\t\t\t></div>\n\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\x3c!-- BUTTON: ADD TRAIT --\x3e\n\t\t\t\t\t\t\t\t<div id="trait-placeholder" class="add-item no-print"></div>\n\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\x3c!-- BUTTON: ADD TRAIT GROUP --\x3e\n\t\t\t\t\t\t<div id="trait-group-placeholder" class="add-item no-print"></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t</div> \x3c!-- .content --\x3e\n\t\t\t</div> \x3c!-- .page --\x3e\n\t\t</div> \x3c!-- .pages --\x3e\n\t</article>',methods:{export(){return{name:this.name,description:this.description,distinctions:this.distinctions,attributes:this.attributes,sets:this.sets,image:this.image}},editContent(t,n){let e=t.target.innerText;switch(n[0]){case"name":this.name=this.sanitizeString(e);break;case"description":this.description=this.sanitizeString(e);break;case"distinctions":let t=n[1],i=this.distinctions[t];switch(n[2]){case"name":i.name=this.sanitizeString(e);break;case"value":i.name=Number(e);break;case"description":i.name=this.sanitizeString(e);break;case"sfx":let t=n[3];switch(n[4]){case"name":i.sfx[t].name=this.sanitizeString(e);break;case"description":i.sfx[t].description=this.sanitizeString(e)}}this.$set(this.distinctions,t,i);break;case"attributes":let s=n[1],a=this.attributes[s];switch(n[2]){case"name":case"description":a.name=this.sanitizeString(e);break;case"value":a.name=Number(e)}this.$set(this.attributes,s,a);break;case"set":let r=n[1],c=this.sets[r];switch(n[2]){case"name":c.name=this.sanitizeString(e);break;case"trait":let t=n[3],i=c.traits[t];switch(n[4]){case"name":i.name=this.sanitizeString(e);break;case"value":i.value=Number(e);break;case"description":i.description=this.sanitizeString(e)}c.traits[t]=i}this.$set(this.sets,r,c)}this.$emit("edited",this.export())},sanitizeString:t=>t=String(t).trim(),getAttributeStyle(t){let n,e;if(1===this.attributes.length)n="149mm",e="120mm";else{let i=t/(this.attributes.length-1),s=115,a=10,r=107.5;n=(176-s)*i+s+3.5+"mm",e=Math.sin(3.1415926535*i)*a+r-3+"mm"}return`left: ${n}; top: ${e};`}}});
