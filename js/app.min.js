window.cortexFunctions={arraysMatch:function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(let a=0;a<t.length;a++)if(t[a]!==e[a])return!1;return!0}},Vue.component("characterSheet",{props:{character:Object,editable:Boolean,selected:Array},data:function(){return{}},computed:{name(){return this.character?.name??""},description(){return this.character?.description??""},portrait(){return this.character?.portrait??null},traitSets(){return this.character?.traitSets??[]},distinctions(){return this.traitSets.find((t=>"distinctions"===t.style))},attributes(){return this.traitSets.find((t=>"attributes"===t.location))?.traits||[]},attributesID(){return this.traitSets.findIndex((t=>"attributes"===t.location))}},template:'<section class="character-sheet">\n\t\n\t\t<div class="pages">\n\n\t\t\t\x3c!-- PAGE --\x3e\n\t\t\t<div class="page">\n\t\t\t\t<div class="page-inner">\n\n\t\t\t\t\t\x3c!-- CHARACTER NAME --\x3e\n\t\t\t\t\t<div :class="{\'title-container\': true, \'selected\': isSelected([\'name\'])}"\n\t\t\t\t\t\t@click.prevent="select([ \'name\' ])"\n\t\t\t\t\t>\n\n\t\t\t\t\t\t<div class="title"\n\t\t\t\t\t\t\tv-html="name"\n\t\t\t\t\t\t></div>\n\n\t\t\t\t\t\t<div class="title-decoration">\n\t\t\t\t\t\t\t<svg height="4" width="100%"><line x1="0" y1="0" x2="10000" y2="0" style="stroke:#C50852;stroke-width:4pt"/></svg>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\n\t\t\t\t\t\x3c!-- CHARACTER DESCRIPTION --\x3e\n\t\t\t\t\t<div class="subtitle"\n\t\t\t\t\t\t@click.prevent="select([ \'description\' ])"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span v-html="description"></span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t\x3c!-- COLUMNS --\x3e\n\t\t\t\t\t<div class="columns">\n\n\t\t\t\t\t\t<div v-for="pageLocation in [\'left\', \'right\']" :class="\'column-\' + pageLocation">\n\n\t\t\t\t\t\t\t\x3c!-- IMAGE --\x3e\n\t\t\t\t\t\t\t<div class="portrait" v-if="pageLocation === \'right\'"\n\t\t\t\t\t\t\t\t@click.prevent="select([ \'portrait\' ])"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class="portrait-circle" width=100% height=100%>\n\t\t\t\t\t\t\t\t\t<img src="" width="110%" draggable="false" class="image"></img>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\x3c!-- ATTRIBUTES --\x3e\n\t\t\t\t\t\t\t<div class="attribute-curve" xmlns="http://www.w3.org/2000/svg"\n\t\t\t\t\t\t\t\t:style="\'display: \' + ( attributes.length >= 2 ? \'block\' : \'none\' ) + \';\'"\n\t\t\t\t\t\t\t\tv-if="pageLocation === \'right\'"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg viewBox="0 0 62 62" width="62mm" height="30mm" preserveAspectRatio="xMidYMid slice">\n\t\t\t\t\t\t\t\t\t<path d="M -17 -25 A 32 32 0 0 0 79 0" stroke="#C50852" stroke-width="0.5mm" fill="transparent" vector-effect="non-scaling-stroke"/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div :class="{ \'attributes\': true, \'vertical\': attributes.length > 5 }"\n\t\t\t\t\t\t\t\tv-if="pageLocation === \'right\'"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div v-for="( attribute, a ) in attributes"\n\t\t\t\t\t\t\t\t\t:class="{ \'attribute\': true, \'vertical\': attributes.length > 5 }"\n\t\t\t\t\t\t\t\t\t:style="getAttributeStyle( a )"\n\t\t\t\t\t\t\t\t\t@click.prevent="select([ \'trait\', attributesID, a ])"\n\t\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t\t\t<span class="c"\n\t\t\t\t\t\t\t\t\t\tv-html="attribute.value"\n\t\t\t\t\t\t\t\t\t></span>\n\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tv-html="attribute.name"\n\t\t\t\t\t\t\t\t\t></div>\n\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\x3c!-- BUTTON: ADD ATTRIBUTE --\x3e\n\t\t\t\t\t\t\t\t<div class="attribute-placeholder add-item"\n\t\t\t\t\t\t\t\t\t@click.prevent="addTrait( attributesID )"\n\t\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\x3c!-- TRAITS --\x3e\n\t\t\t\t\t\t\t<div :class="\'trait-set style-\' + traitSet.style"\n\t\t\t\t\t\t\t\tv-for="(traitSet, s) in traitSets"\n\t\t\t\t\t\t\t\tv-if="traitSet.location === pageLocation"\n\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t\t<div class="trait-set-header"\n\t\t\t\t\t\t\t\t\t@click.prevent="select([ \'traitSet\', s ])"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div v-text="traitSet.name"></div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class="trait-columns">\n\t\t\t\t\t\t\t\t\t<div class="trait-column" v-for="traitSetLocation in [\'left\', \'right\']">\n\n\t\t\t\t\t\t\t\t\t\t<div class="trait"\n\t\t\t\t\t\t\t\t\t\t\tv-for="(trait, t) in traitSet.traits"\n\t\t\t\t\t\t\t\t\t\t\tv-if="trait.location === traitSetLocation"\n\t\t\t\t\t\t\t\t\t\t\t@click.prevent="select([ \'trait\', s, t ])"\n\t\t\t\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t\t\t\t\t<h2 class="trait-title">\n\n\t\t\t\t\t\t\t\t\t\t\t\t<span class="trait-name"\n\t\t\t\t\t\t\t\t\t\t\t\t\tv-html="trait.name"\n\t\t\t\t\t\t\t\t\t\t\t\t></span>\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t<span class="trait-value c"\n\t\t\t\t\t\t\t\t\t\t\t\t\tv-html="trait.value"\n\t\t\t\t\t\t\t\t\t\t\t\t></span>\n\n\t\t\t\t\t\t\t\t\t\t\t</h2>\n\n\t\t\t\t\t\t\t\t\t\t\t<hr>\n\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tclass="trait-description"\n\t\t\t\t\t\t\t\t\t\t\t\tv-html="trait.description"\n\t\t\t\t\t\t\t\t\t\t\t></div>\n\n\t\t\t\t\t\t\t\t\t\t\t<ul class="trait-sfx" v-if="trait.sfx && trait.sfx.length">\n\t\t\t\t\t\t\t\t\t\t\t\t<li v-for="(sfx, s) in trait.sfx">\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="trait-sfx-name"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tv-html="sfx.name"\n\t\t\t\t\t\t\t\t\t\t\t\t\t></span>:\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="trait-sfx-description"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tv-html="sfx.description"\n\t\t\t\t\t\t\t\t\t\t\t\t\t></span>\n\n\t\t\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\t\t</ul>\n\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\x3c!-- BUTTON: ADD TRAIT --\x3e\n\t\t\t\t\t\t\t\t\t\t<div class="trait-placeholder add-item"\n\t\t\t\t\t\t\t\t\t\t\t@click.prevent="addTrait( s, traitSetLocation )"\n\t\t\t\t\t\t\t\t\t\t></div>\n\n\t\t\t\t\t\t\t\t\t</div> \x3c!-- .trait-column --\x3e\n\t\t\t\t\t\t\t\t</div> \x3c!-- .trait-columns --\x3e\n\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\x3c!-- BUTTON: ADD TRAIT GROUP --\x3e\n\t\t\t\t\t\t\t<div class="trait-set-placeholder add-item"\n\t\t\t\t\t\t\t\t@click.prevent="addTraitSet( pageLocation )"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div> \x3c!-- .columns --\x3e\n\t\t\t\t</div> \x3c!-- .page-inner --\x3e\n\t\t\t</div> \x3c!-- .page --\x3e\n\t\t</div> \x3c!-- .pages --\x3e\n\t</section>',methods:{isSelected(t){return cortexFunctions.arraysMatch(this.selected,t)},getAttributeStyle(t){let e,a;if(1===this.attributes.length)e="149mm",a="120mm";else{let i=t/(this.attributes.length-1),n=115,r=10,s=107.5;e=(176-n)*i+n+3.5+"mm",a=Math.sin(3.1415926535*i)*r+s-3+"mm"}return`left: ${e}; top: ${a};`},addTraitSet(t){this.$emit("addTraitSet",t)},addTrait(t,e){this.$emit("addTrait",t,e)},select(t){this.$emit("select",t)}}}),Vue.component("characterEditor",{props:{character:Object,editable:Boolean,selected:Array},data:function(){return structuredClone(this.character)},computed:{},template:'<section class="character-editor">\n\t\n\t</section>',methods:{editContent(t,e){let a=t.target.innerHTML;switch(e[0]){case"name":this.name=this.sanitizeString(a);break;case"description":this.description=this.sanitizeString(a);break;case"traitSet":let t=e[1],i=this.traitSets[t];switch(e[2]){case"name":i.name=this.sanitizeString(a);break;case"trait":let t=e[3],n=i.traits[t];switch(e[4]){case"name":n.name=this.sanitizeString(a);break;case"value":n.value=Number(a);break;case"description":n.description=this.sanitizeString(a);break;case"sfx":let t=e[3];switch(e[4]){case"name":n.sfx[t].name=this.sanitizeString(a);break;case"description":n.sfx[t].description=this.sanitizeString(a)}}i.traits[t]=n}this.$set(this.traitSets,t,i)}this.export()},sanitizeString:t=>t=String(t).trim(),addTraitSet(t){this.traitSets.push({name:"New trait group",style:"default",location:t??"left",traits:[{name:"New trait",value:6,description:"Trait description",location:"left"}]}),this.export()},removeSet(t){this.traitSets.splice(t,1),this.export()},addTrait(t,e){let a=this.traitSets[t];a.traits.push({name:"New trait",value:6,description:"Trait description",location:e??"left"}),this.$set(this.traitSets,t,a),this.export()},removeTrait(t,e){let a=this.traitSets[t];a.traits.splice(e,1),this.$set(this.traitSets,t,a),this.export()},export(){let t={name:this.name,description:this.description,traitSets:this.traitSets,portrait:this.portrait};this.$emit("edited",t)}}}),document.addEventListener("DOMContentLoaded",(()=>{new Vue({name:"cortex-tools",el:"#cortex-tools",data:{baseURL:window.location.href,character:null,selected:null,editable:!0},computed:{},template:'<article id="cortex-tools">\n\t\t\n\t\t\t<header class="header">\n\n\t\t\t\t<div class="header-collapsed-content">\n\t\t\t\t</div>\n\n\t\t\t\t<div class="header-expanded-content">\n\n\t\t\t\t\t<section class="controls">\n\n\t\t\t\t\t\t\x3c!-- CHARACTER EDITOR --\x3e\n\t\t\t\t\t\t<character-editor\n\t\t\t\t\t\t\tref="characterEditor"\n\t\t\t\t\t\t\tv-if="character"\n\t\t\t\t\t\t\t:character="character"\n\t\t\t\t\t\t\t:selected="selected"\n\t\t\t\t\t\t\t:editable="editable"\n\t\t\t\t\t\t\t@edited="setCharacter"\n\t\t\t\t\t\t></character-editor>\n\n\t\t\t\t\t</section>\n\n\t\t\t\t\t<footer class="footer">\n\n\t\t\t\t\t\t<div class="footer-logo">\n\t\t\t\t\t\t\t<a href="https://cortexrpg.com" target="_blank"><img src="images/cortex_community_logo_white.png"></a>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="footer-legal">\n\t\t\t\t\t\t\t\t<p>Cortex Prime is the award-winning world-building tabletop RPG system for forging unique, compelling game experiences from a set of modular rules mechanics available at CortexRPG.com </p>\n\t\t\t\t\t\t\t\t<p>Cortex is ©️ 2022 Fandom, Inc. Cortex, Cortex Prime, associated logos and trade dress are the trademarks of Fandom, Inc. Iconography used with permission.</p>\n\t\t\t\t\t\t\t\t<p>If you wish to publish or sell what you make using this tool, it is your responsibility to ensure you have the proper license or right for any resources used. No rights are granted through the use of this tool.</p>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</footer>\n\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t</header>\n\n\t\t\t<main class="main">\n\t\t\t\n\t\t\t\t\x3c!-- CHARACTER SHEET --\x3e\n\t\t\t\t<character-sheet\n\t\t\t\t\tv-if="character"\n\t\t\t\t\t:character="character"\n\t\t\t\t\t:selected="selected"\n\t\t\t\t\t:editable="editable"\n\t\t\t\t\t@addTraitSet="addTraitSet"\n\t\t\t\t\t@addTrait="addTrait"\n\t\t\t\t\t@select="select"\n\t\t\t\t></character-sheet>\n\n\t\t\t</main>\n\n\t\t</article>',mounted(){this.loadLocal()},watch:{character(t){pageTitle="Cortex Tools",t.name&&t.name.length&&(pageTitle=`${t.name} | ${pageTitle}`),document.title=pageTitle}},methods:{async createDefaultCharacter(){return await fetch(this.baseURL+"data/cortex_character_default.json").then((t=>t.json()))},setCharacter(t){this.character=t,this.saveLocal()},select(t){cortexFunctions.arraysMatch(this.selected,t)?this.selected=[]:this.selected=t},addTraitSet(t){this.$refs.characterEditor.addTraitSet(t)},addTrait(t,e){this.$refs.characterEditor.addTrait(t,e)},async loadLocal(){let t=null,e=localStorage.getItem("cortexToolsData");if(e&&e.length){let a=JSON.parse(e);a&&(t=a.character)}t||(t=await this.createDefaultCharacter()),this.character=t},saveLocal(){localStorage.setItem("cortexToolsData",JSON.stringify({character:this.character}))}}})}));
